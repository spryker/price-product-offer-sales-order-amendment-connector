{% extends model('component') %}

{% define config = {
    name: 'asset-details-title',
} %}

{% define data = {
    title: required,
    reference: required,
    unassignBusinessUnitForm: null,
    canBusinessUnitBeUnassigned: true,
} %}

{% set confirmationTrigger = "js-#{config.name}-confirmation-trigger" %}

{% block body %}
    <div class="grid grid--middle">
        <div class="col col--sm-9">
            {% block title %}
                <span class="title title--h3">{{ data.title }}</span>
            {% endblock %}
        </div>
        <div class="col col--sm-3">
            {% block actions %}
                <div class="grid grid--right">
                    <div class="col spacing-right">
                        {% block unassign %}
                            {% if data.canBusinessUnitBeUnassigned and can('UnassignSspAssetPermissionPlugin') %}
                                <button title="{{ 'ssp_asset.details_page.unassign' | trans }}" class="link {{ confirmationTrigger }}"
                                    {{ qa('unassign-ssp-asset-link') }}>
                                    {% include atom('icon') with {
                                        data: {
                                            name: 'remove',
                                        }
                                    } only %}
                                </button>
                            {% endif %}
                        {% endblock %}
                    </div>
                    <div class="col">
                        {% block edit %}
                            {% if can('UpdateSspAssetPermissionPlugin') %}
                                <a
                                    href="{{ url('customer/asset/update', { reference: data.reference }) }}"
                                    title="{{ 'general.edit.button' | trans }}"
                                    data-qa="edit-ssp-asset">
                                    {% include atom('icon') with {
                                        data: {
                                            name: 'edit',
                                        }
                                    } only %}
                                </a>
                            {% endif %}
                        {% endblock %}
                    </div>
                </div>
            {% endblock %}
        </div>
    </div>

    {% block popup %}
        {% include molecule('main-popup') with {
            data: {
                title: 'ssp_asset.details_page.confirm_unassign_title' | trans,
                content: block('confirmationUnassign'),
            },
            attributes: {
                'content-id': 'confirm-unassign',
                'trigger-class-name': confirmationTrigger,
            },
        } only %}
    {% endblock %}
{% endblock %}

{% block confirmationUnassign %}
    <div class="spacing-x">
        <p>{{ 'ssp_asset.details_page.confirm_unassign_body' | trans }}</p>

        <div class="grid grid--right">
            <div class="col">
                <button type="button" class="js-main-popup-close button button--hollow">
                    {{ 'general.cancel.button' | trans }}
                </button>
            </div>
            {% if data.unassignBusinessUnitForm %}
                {{ form_start(data.unassignBusinessUnitForm, {
                    'action': path('customer/asset/update-relations', {'reference': data.reference})
                }) }}
                    <div class="col spacing-left">
                        <button class="button button--primary" {{ qa('unassign-ssp-asset') }}>
                            {{ 'general.confirm.button' | trans }}
                        </button>
                    </div>
                {{ form_end(data.unassignBusinessUnitForm) }}
            {% endif %}
        </div>
    </div>
{% endblock %}
